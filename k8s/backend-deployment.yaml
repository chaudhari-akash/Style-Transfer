apiVersion: apps/v1
kind: Deployment
metadata:
  name: backend-deployment 
  namespace: default
spec:
  replicas: 1 
  selector:
    matchLabels:
      app: backend
  template:
    metadata:
      labels:
        app: backend 
    spec:
      volumes:
      - name: model-storage 
        persistentVolumeClaim: 
          claimName: model-pvc

      containers: 
      - name: backend-container 
        image: chaudhariakash/app-backend:latest 
        ports: 
        - containerPort: 5000 

        env:
        - name: CLOUDINARY_CLOUD_NAME 
          valueFrom:
            secretKeyRef:
              name: cloudinary-secrets 
              key: CLOUDINARY_CLOUD_NAME 
        - name: CLOUDINARY_API_KEY
          valueFrom:
            secretKeyRef:
              name: cloudinary-secrets
              key: CLOUDINARY_API_KEY
        - name: CLOUDINARY_API_SECRET 
          valueFrom:
            secretKeyRef:
              name: cloudinary-secrets
              key: CLOUDINARY_API_SECRET

        - name: MODEL_PATH
          value: "/app/models/persistent/model_state.pth"

        resources:
          requests:
            cpu: 2000m 
            memory: 1Gi
          limits:
            cpu: 6000m 
            memory: 2Gi 

        volumeMounts:
        - name: model-storage 
          mountPath: "/app/models/persistent" 
          readOnly: true 